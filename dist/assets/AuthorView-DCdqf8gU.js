import{T as R,p as F}from"./TipModal-Bg00hvx_.js";import{u as I,a as q,C as O}from"./contract-CXvXk3HC.js";import{h as P,i as W,j as G,r as o,b as H,l as S,c as n,a as e,e as D,f as w,t as u,F as M,g as J,m as K,o as l,p as Q,u as U,q as X,v as Y}from"./index-Cv26Cw_D.js";const Z={class:"book-view"},ee={key:0,class:"box1"},te={class:"meta-header",style:{"margin-bottom":"0rem"}},se={class:"author-info"},ae=["src"],oe={class:"author-name",style:{"font-weight":"bold"}},ne={class:"total-tip",style:{color:"#878787","font-size":"12px"}},le={key:1,class:"content",style:{"margin-top":"0rem"}},ie={class:"article-content"},ce={class:"text-content"},re={class:"title title-max-line"},ue={class:"description description-max-line"},de={class:"cover-container"},ve=["src","alt"],_e={class:"action-bar"},he={class:"date"},me={class:"tip-container"},pe={class:"tip-count"},fe=["disabled","onClick"],ge={key:0},we={key:1,class:"loader2"},Ce={__name:"AuthorView",props:{id:String},setup(A){const{address:y}=P(),B=W(()=>({address:y.value})),{data:b}=G(B),_=o(!1),v=o({status:"input",nonce:0,message:""}),h=o(null),{writeContractAsync:$}=I(),m=o(!1),p=o(!1),f=o(0),g=o(5),d=o([]),i=o([]);H(async()=>{await V(),console.log(i.value),await x()});const k=A,V=async()=>{try{const t=await S.get(`https://api.rawaki.xyz/user?fid=${k.id}`);i.value=t.data.data}catch{return null}},x=async(t=!1)=>{var s;try{t&&(f.value=0,d.value=[]);const c=await S.get(`https://api.rawaki.xyz/article_by_fid?offset=${f.value}&limit=${g.value}&fid=${k.id}`),r=((s=c==null?void 0:c.data)==null?void 0:s.data)||[];d.value=[...d.value,...r],r.length>0?(f.value+=g.value,r.length<=g.value&&(m.value=!0)):m.value=!0}catch{return null}},z=async()=>{p.value=!0,await x(!1),p.value=!1},E=t=>{h.value=t,_.value=!0},j=async t=>{try{const s=b.value.value?Number(Y(b.value.value)):0;if(console.log(s),console.log(Number(t)),Number(t)>s){v.value={status:"error",nonce:Date.now(),message:"insufficient balance!"};return}console.log("Send",t,"Tip to id article: ",h.value),await $({address:O,abi:q,functionName:"tipArticle",args:[Number(h.value)],value:F(t.toString())}),v.value={status:"success",nonce:Date.now(),message:"Transaction complete."}}catch{v.value={status:"error",nonce:Date.now(),message:"Transaction rejected!"}}},L=t=>{const s={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("id-ID",s)};return(t,s)=>{var r,C,T,N;const c=K("router-link");return l(),n(M,null,[e("div",Z,[i.value.displayName?(l(),n("div",ee,[e("div",te,[e("div",se,[e("img",{src:(C=(r=i.value)==null?void 0:r.pfp)==null?void 0:C.url,class:"author-logo",alt:"author"},null,8,ae),e("span",oe,u((T=i.value)==null?void 0:T.displayName),1)]),e("div",ne,"#"+u((N=i.value)==null?void 0:N.username),1)])])):w("",!0),d.value.length>0?(l(),n("div",le,[(l(!0),n(M,null,J(d.value,a=>(l(),n("div",{key:a.article_id,class:"article-card"},[e("div",ie,[D(c,{to:{name:"article",params:{id:a.article_id}},class:"main-content-2 clickable-area"},{default:Q(()=>[e("div",ce,[e("h2",re,u(a.title),1),e("p",ue,u(a.description),1)]),e("div",de,[e("img",{src:a.thumbnail,alt:a.title,class:"cover-image"},null,8,ve)])]),_:2},1032,["to"]),e("div",_e,[e("span",he,u(L(a.created_at_human)),1),e("div",me,[e("span",pe,u(a.tip_count)+" Tip",1),e("button",{disabled:U(y)==a.wallet_address,class:"tip-button",onClick:ye=>E(a.article_id)},s[1]||(s[1]=[e("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),X(" Tip Me ")]),8,fe)])])])]))),128)),m.value?w("",!0):(l(),n("div",ge,[p.value?(l(),n("div",we)):(l(),n("button",{key:0,class:"load-more-button",onClick:z}," Load More "))]))])):w("",!0)]),D(R,{show:_.value,showState:v.value,onClose:s[0]||(s[0]=a=>_.value=!1),onSend:j},null,8,["show","showState"])],64)}}};export{Ce as default};
