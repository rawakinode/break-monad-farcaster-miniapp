import{c as l,o as c,a as t,_ as V,r as n,b as $,d as j,e as w,f as N,t as r,n as z,u as B,F as T,g as A,w as D,h as I,i as R,j as U,k as q,l as H,m as P,p as M,q as S,s as W,v as G}from"./index-Cv26Cw_D.js";import{T as J,p as K}from"./TipModal-Bg00hvx_.js";import{u as Q,a as X,C as Y}from"./contract-CXvXk3HC.js";function Z(b,m){return c(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}const ee={class:"filter-container"},te={key:0,class:"dropdown"},se=["onClick"],ae={__name:"FilterDropdown",props:{selected:{type:String,default:"Newest"}},emits:["update:selected"],setup(b,{emit:m}){const y=b,g=m,h=["Newest","Oldest"],a=n(!1),v=n(y.selected),x=()=>{a.value=!a.value},f=i=>{v.value=i,a.value=!1,g("update:selected",i)},_=i=>{i.target.closest(".filter-box")||(a.value=!1)};return $(()=>{document.addEventListener("click",_)}),j(()=>{document.removeEventListener("click",_)}),(i,k)=>(c(),l("div",ee,[t("div",{class:"filter-box",onClick:D(x,["stop"])},[t("span",null,r(v.value),1),w(B(Z),{class:z(["chevron",{"rotate-180":a.value}])},null,8,["class"]),a.value?(c(),l("div",te,[(c(),l(T,null,A(h,d=>t("div",{key:d,class:"dropdown-item",onClick:D(p=>f(d),["stop"])},r(d),9,se)),64))])):N("",!0)])]))}},oe=V(ae,[["__scopeId","data-v-9fc220ba"]]),ne={class:"book-view"},le={key:0,class:"content"},ce={class:"article-content"},ie={class:"meta-header"},re=["src"],de={class:"author-name"},ue={class:"total-tip"},ve={class:"text-content"},_e={class:"title title-max-line"},pe={class:"description description-max-line"},me={class:"cover-container"},he=["src","alt"],fe={class:"action-bar"},we={class:"date"},ge={class:"tip-container"},ke={class:"tip-count"},be=["disabled","onClick"],ye={key:0},xe={key:1,class:"loader2"},Me={__name:"BookView",setup(b){const{address:m}=I(),y=R(()=>({address:m.value})),{data:g}=U(y),h=n(!1),a=n({status:"input",nonce:0,message:""}),v=n(null),{writeContractAsync:x}=Q(),f=n(!1),_=n(!1),i=n("Newest"),k=n(0),d=n(5),p=n([]);$(async()=>{await C()}),q(i,async()=>{await C(!0)});const C=async(o=!1)=>{var s;try{o&&(k.value=0,p.value=[]);const u=await H.get(`https://api.rawaki.xyz/articles?offset=${k.value}&limit=${d.value}&orderBy=${i.value}`),e=((s=u==null?void 0:u.data)==null?void 0:s.data)||[];p.value=[...p.value,...e],e.length>0?(k.value+=d.value,e.length<=d.value&&(f.value=!0)):f.value=!0}catch{return null}},O=async()=>{_.value=!0,await C(!1),_.value=!1},E=o=>{v.value=o,h.value=!0},F=async o=>{try{const s=g.value.value?Number(G(g.value.value)):0;if(console.log(s),console.log(Number(o)),Number(o)>s){a.value={status:"error",nonce:Date.now(),message:"insufficient balance!"};return}console.log("Send",o,"Tip to id article: ",v.value),await x({address:Y,abi:X,functionName:"tipArticle",args:[Number(v.value)],value:K(o.toString())}),a.value={status:"success",nonce:Date.now(),message:"Transaction complete."}}catch{a.value={status:"error",nonce:Date.now(),message:"Transaction rejected!"}}},L=o=>{const s={year:"numeric",month:"long",day:"numeric"};return new Date(o).toLocaleDateString("id-ID",s)};return(o,s)=>{const u=P("router-link");return c(),l(T,null,[t("div",ne,[w(oe,{selected:i.value,"onUpdate:selected":s[0]||(s[0]=e=>i.value=e)},null,8,["selected"]),p.value.length>0?(c(),l("div",le,[(c(!0),l(T,null,A(p.value,e=>(c(),l("div",{key:e.article_id,class:"article-card"},[t("div",ce,[t("div",ie,[w(u,{class:"author-info clickable-area",to:{name:"author",params:{id:e.account_id}}},{default:M(()=>[t("img",{src:e==null?void 0:e.profile,class:"author-logo",alt:"author"},null,8,re),t("span",de,r(e==null?void 0:e.display_name),1)]),_:2},1032,["to"]),t("div",ue,[s[2]||(s[2]=t("img",{src:W,alt:"",height:"10px"},null,-1)),S(" "+r(e.tip_earned)+" MON",1)])]),w(u,{to:{name:"article",params:{id:e.article_id}},class:"main-content-2 clickable-area"},{default:M(()=>[t("div",ve,[t("h2",_e,r(e.title),1),t("p",pe,r(e.description),1)]),t("div",me,[t("img",{src:e.thumbnail,alt:e.title,class:"cover-image"},null,8,he)])]),_:2},1032,["to"]),t("div",fe,[t("span",we,r(L(e.created_at_human)),1),t("div",ge,[t("span",ke,r(e.tip_count)+" Tip",1),t("button",{disabled:B(m)==e.wallet_address,class:"tip-button",onClick:Ce=>E(e.article_id)},s[3]||(s[3]=[t("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),S(" Tip Me ")]),8,be)])])])]))),128)),f.value?N("",!0):(c(),l("div",ye,[_.value?(c(),l("div",xe)):(c(),l("button",{key:0,class:"load-more-button",onClick:O}," Load More "))]))])):N("",!0)]),w(J,{show:h.value,showState:a.value,onClose:s[1]||(s[1]=e=>h.value=!1),onSend:F},null,8,["show","showState"])],64)}}};export{Me as default};
